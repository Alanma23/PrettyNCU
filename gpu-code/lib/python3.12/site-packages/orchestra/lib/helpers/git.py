"""Git helper functions for Orchestra."""

import subprocess
from pathlib import Path
from typing import Optional

from orchestra.lib.logger import get_logger

logger = get_logger(__name__)


def get_current_branch(repo_path: Optional[str] = None) -> Optional[str]:
    """Get the current git branch."""
    try:
        cmd = ["git", "rev-parse", "--abbrev-ref", "HEAD"]

        if repo_path:
            cmd.extend(["-C", repo_path])

        result = subprocess.run(
            cmd,
            capture_output=True,
            text=True,
            cwd=repo_path,
        )

        if result.returncode == 0:
            return result.stdout.strip()

        return None

    except Exception as e:
        logger.error(f"Error getting current branch: {e}")
        return None
